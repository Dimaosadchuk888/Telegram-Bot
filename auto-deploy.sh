#!/bin/bash

echo "ðŸš€ ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð™ Ð”Ð•ÐŸÐ›ÐžÐ™ TELEGRAM BOT"
echo "======================================"
echo ""

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
log() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

step() {
    echo -e "${BLUE}[STEP]${NC} $1"
}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
step "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."
if [ ! -f "package.json" ]; then
    error "package.json Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    exit 1
fi

if [ ! -d "src" ]; then
    error "ÐŸÐ°Ð¿ÐºÐ° src Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°!"
    exit 1
fi

log "Ð’ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ âœ“"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Git
step "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ..."
if [ ! -d ".git" ]; then
    log "Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ..."
    git init
fi

# Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Git
step "Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Git..."
git add .

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
if git diff --cached --quiet; then
    warning "ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°"
else
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°..."
    git commit -m "Auto-deploy: Telegram Farming Bot with UI buttons and balance logic"
fi

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
step "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° GitHub Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ..."
if ! git remote get-url origin > /dev/null 2>&1; then
    git remote add origin https://github.com/Dimaosadchuk888/Telegram-Bot.git
    log "Ð£Ð´Ð°Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½"
else
    log "Ð£Ð´Ð°Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ ÑƒÐ¶Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
fi

# ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÐµÑ‚ÐºÐ¸ Ð² main
git branch -M main

# ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° GitHub
step "Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð° GitHub..."
echo ""
warning "Ð”Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° GitHub Ð½ÑƒÐ¶Ð½Ð° Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ."
echo ""
echo "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ¿Ð¾ÑÐ¾Ð± Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸:"
echo "1. Personal Access Token (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)"
echo "2. GitHub CLI"
echo "3. Ð ÑƒÑ‡Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ"
echo ""

read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð° (1-3): " choice

case $choice in
    1)
        echo ""
        log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Personal Access Token..."
        echo "1. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° https://github.com/settings/tokens"
        echo "2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Generate new token (classic)'"
        echo "3. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ 'repo' Ð¿Ñ€Ð°Ð²Ð°"
        echo "4. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½"
        echo ""
        read -s -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Personal Access Token: " token
        echo ""
        
        if [ ! -z "$token" ]; then
            git remote set-url origin https://${token}@github.com/Dimaosadchuk888/Telegram-Bot.git
            log "ÐŸÐ¾Ð¿Ñ‹Ñ‚ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° GitHub..."
            if git push -u origin main; then
                log "âœ… ÐšÐ¾Ð´ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½ Ð½Ð° GitHub!"
            else
                error "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð½Ð° GitHub"
                echo "ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 3 - Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ"
            fi
        else
            error "Ð¢Ð¾ÐºÐµÐ½ Ð½Ðµ Ð²Ð²ÐµÐ´ÐµÐ½"
        fi
        ;;
    2)
        echo ""
        log "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° GitHub CLI..."
        if command -v brew &> /dev/null; then
            brew install gh
        else
            warning "Homebrew Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ GitHub CLI Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:"
            echo "https://cli.github.com/"
            echo "Ð—Ð°Ñ‚ÐµÐ¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ: gh auth login"
        fi
        ;;
    3)
        echo ""
        log "Ð ÑƒÑ‡Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ"
        echo ""
        echo "ðŸ“‹ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸:"
        echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ https://github.com/Dimaosadchuk888/Telegram-Bot"
        echo "2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Add file' â†’ 'Upload files'"
        echo "3. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð¿Ð°Ð¿ÐºÐ¸ (ÐºÑ€Ð¾Ð¼Ðµ .git Ð¸ node_modules)"
        echo "4. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ: 'Auto-deploy: Telegram Farming Bot'"
        echo "5. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Commit changes'"
        echo ""
        echo "Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸:"
        ls -la | grep -E "\.(js|json|md|sh)$|^src$|^package\.json$|^README\.md$|^railway\.json$"
        echo ""
        ;;
    *)
        error "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€"
        exit 1
        ;;
esac

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Railway
echo ""
step "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Railway..."
echo ""
log "ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° GitHub:"
echo "1. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° https://railway.app"
echo "2. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· GitHub"
echo "3. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'New Project'"
echo "4. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ 'Deploy from GitHub repo'"
echo "5. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ 'Telegram-Bot'"
echo ""

# ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Railway
echo "ðŸ“ ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Railway:"
echo "BOT_TOKEN=your_actual_bot_token_here"
echo "NODE_ENV=production"
echo "WEBHOOK_URL=https://your-railway-domain.railway.app/webhook"
echo "PORT=3000"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼Ð¸
cat > RAILWAY_SETUP.md << 'EOF'
# ðŸš€ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Railway

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ ÑˆÐ°Ð³Ð¸:

1. **ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° Railway**: https://railway.app
2. **Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· GitHub**
3. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚**: "New Project"
4. **Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹**: "Deploy from GitHub repo"
5. **Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ**: Dimaosadchuk888/Telegram-Bot

## ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² Railway Dashboard:

```
BOT_TOKEN=your_actual_bot_token_here
NODE_ENV=production
WEBHOOK_URL=https://your-railway-domain.railway.app/webhook
PORT=3000
```

## ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚Ð¾ÐºÐµÐ½Ð° Ð±Ð¾Ñ‚Ð°:

1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ @BotFather Ð² Telegram
2. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ /newbot
3. Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼
4. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:

1. Ð”Ð¾Ð¶Ð´Ð¸Ñ‚ÐµÑÑŒ Ð´ÐµÐ¿Ð»Ð¾Ñ (Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ)
2. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð° Ð² Telegram
3. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ /start
4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð²ÑÐµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¼ÐµÐ½ÑŽ

## Ð›Ð¾Ð³Ð¸ Ð¸ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ°:

- Ð’ Railway Dashboard â†’ Deployments â†’ View Logs
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð±Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»ÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ webhook Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
EOF

log "âœ… Ð¤Ð°Ð¹Ð» RAILWAY_SETUP.md ÑÐ¾Ð·Ð´Ð°Ð½ Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼Ð¸"

echo ""
log "ðŸŽ‰ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ ÐºÐ¾Ð´ Ð½Ð° GitHub (Ð²Ñ‹ÑˆÐµ)"
echo "2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Railway (ÑÐ¼. RAILWAY_SETUP.md)"
echo "3. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð° Ñƒ @BotFather"
echo "4. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð² Railway"
echo "5. ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° Ð² Telegram"
echo ""
echo "ðŸ“š Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ:"
echo "- README.md - Ð¾Ð±Ñ‰Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ"
echo "- TESTING.md - Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÑŽ"
echo "- DEPLOYMENT.md - Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¹ Ð³Ð°Ð¹Ð´ Ð¿Ð¾ Ð´ÐµÐ¿Ð»Ð¾ÑŽ"
echo "- RAILWAY_SETUP.md - Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Railway"
echo ""
